---
- name: Install common
  dnf:
    name: ['libvirt-devel', 'git',
 'gcc', 'gcc-c++', '@virtualization', 'zlib-devel', 'awscli', 'ruby-devel', 
'qemu', 'libvirt', 'libvirt-devel', 'rubygem-ruby-libvirt', 'libxslt-devel', 
'libxml2-devel', 'libvirt-devel', 'libguestfs-tools-c', 'libxslt-devel', 
'libxml2-devel', 'libvirt-devel', 'libguestfs-tools-c']

# Workaround - Due to https://github.com/vagrant-libvirt/vagrant-libvirt/issues/1031
- name: install vagrant
  dnf:
    name: vagrant
    state: present

# Check if installed
- name: check if vagrant plugins are installed
  shell: vagrant plugin list
  become: no
  register: vagrant_plugins
  changed_when: False

- name: Install vagrant aws plugin
  shell: vagrant plugin install vagrant-aws
  become: no
  when: '"vagrant-aws" not in vagrant_plugins.stdout'
- name: Install vagrant digitalocean plugin
  shell: vagrant plugin install vagrant-digitalocean
  become: no
  when: '"vagrant-digitalocean" not in vagrant_plugins.stdout'

# https://github.com/nasskach/vagrant-aws-dns

- name: Install vagrant aws dns plugin
  shell: vagrant plugin install vagrant-aws-dns
  become: no
  when: '"vagrant-aws-dns" not in vagrant_plugins.stdout'

# https://github.com/mitchellh/vagrant-google

- name: Install vagrant google-compute plugin
  shell: vagrant plugin install vagrant-google
  become: no
  when: '"vagrant-google" not in vagrant_plugins.stdout'

- name: Install vagrant scp plugin
  shell: vagrant plugin install vagrant-scp
  become: no
  when: '"vagrant-scp" not in vagrant_plugins.stdout'

# vagrant-libvirt
- name: Install vagrant-libvirt plugin
  shell: vagrant plugin install vagrant-libvirt
  become: no
  when: '"vagrant-libvirt" not in vagrant_plugins.stdout'

# Fedora build of vagrant does not include winrm specifics
- name: Install vagrant winrm 
  shell: vagrant plugin install winrm
  become: no
  when: '"winrm" not in vagrant_plugins.stdout'

- name: Install vagrant winrm-elevated
  shell: vagrant plugin install winrm-elevated
  become: no
  when: '"winrm-elevated" not in vagrant_plugins.stdout'
