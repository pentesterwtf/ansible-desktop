---
- name: Install common
  dnf: name={{ item }}
  with_items:
   - libvirt-devel
   - git
   - gcc
   - gcc-c++
   - "@virtualization"
   - zlib-devel
   - awscli
   - ruby-devel
   - qemu
   - libvirt
   - libvirt-devel
   - rubygem-ruby-libvirt
   - libxslt-devel
   - libxml2-devel
   - libvirt-devel
   - libguestfs-tools-c
   - libxslt-devel
   - libxml2-devel
   - libvirt-devel
   - libguestfs-tools-c

- name: install vagrant
  dnf:
    name: 'https://releases.hashicorp.com/vagrant/2.1.2/vagrant_2.1.2_x86_64.rpm'
    state: present

  # Check if installed
- name: check if vagrant plugins are installed
  shell: vagrant plugin list
  become: no
  register: vagrant_plugins
  changed_when: False

- name: Install vagrant aws plugin
  shell: vagrant plugin install vagrant-aws
  become: no
  when: '"vagrant-aws" not in vagrant_plugins.stdout'
- name: Install vagrant digitalocean plugin
  shell: vagrant plugin install vagrant-digitalocean
  become: no
  when: '"vagrant-digitalocean" not in vagrant_plugins.stdout'

# https://github.com/nasskach/vagrant-aws-dns

- name: Install vagrant aws dns plugin
  shell: vagrant plugin install vagrant-aws-dns
  become: no
  when: '"vagrant-aws-dns" not in vagrant_plugins.stdout'

# https://github.com/mitchellh/vagrant-google

- name: Install vagrant google-compute plugin
  shell: vagrant plugin install vagrant-google
  become: no
  when: '"vagrant-google" not in vagrant_plugins.stdout'

- name: Install vagrant scp plugin
  shell: vagrant plugin install vagrant-scp
  become: no
  when: '"vagrant-scp" not in vagrant_plugins.stdout'

# vagrant-libvirt
- name: Install vagrant-libvirt plugin
  shell: CONFIGURE_ARGS='with-ldflags=-L/opt/vagrant/embedded/lib with-libvirt-include=/usr/include/libvirt with-libvirt-lib=/usr/lib' GEM_HOME=~/.vagrant.d/gems GEM_PATH=$GEM_HOME:/opt/vagrant/embedded/gems PATH=/opt/vagrant/embedded/bin:$PATH vagrant plugin install vagrant-libvirt
  become: no
  when: '"vagrant-libvirt" not in vagrant_plugins.stdout'
